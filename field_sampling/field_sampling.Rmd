---
title: "Using R in field sampling
BIO 104 Lab A1. Species Diversity Report"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goals for Lab 1

* Import data into R
* Save data in R as variables
* Plot diversity data as a scatterplot and a boxplot
* Plot certain parts of your data

## Lab 1 Report Submission

1. Individual Summary Table for your group data
2. Boxplot of diversity data (created in Step 4)
3. Boxplots of biome data (Homework Step 6)
4. Summary of changes in diversity


## 1. Getting Started

You will be using **R** for data analysis this semester. **R** is a versatile, free data handling software widely-used by scientists. Here are some great reasons to use **R**:

* Organize data
* Analyze data
* Graph data

Here is some basic vocabulary you will need when using **R**.
* **R script:** the lines of code that you are writing (filename.R)
* **Variable:** a way to store your data for use in the R script
* **R project:** your R script, any variables you have created, and your current R environment (filename.Rproj)
* **Package:** a set of functions/codes that you can load into your script (examples - gsheet, ggplot2)
* **Function:** an action or calculation that you perform on your variables (examples - subset, mean, ggplot, library)
* **Comment:** does not run as code, starts with #


More great information on R is at [http://www.datacarpentry.org/R-ecology-lesson/00-before-we-start.html#why_learn_r](http://www.datacarpentry.org/R-ecology-lesson/00-before-we-start.html#why_learn_r)


### 1a. Using RStudio
Log in to the R Studio server at https://celsrs.uri.edu/ . This will enable you to run the R software to analyze your data.

You will get your login information from your TA. Your password is the same as username.

**Open RStudio and make a new project.**

* Select from top left corner:  
    + `File` - `New Project...`
    + `New Directory` and `Empty Project` 
    + `Directory name:  FieldSampling`
    + Leave the Subdirectory as the default:  ~
    ![](RStudioFile.png)
                                  
* Select from top left corner:  
    + `File` - `New File` - `R Script`
  
![](RStudioOverview.png)

Making a new project and script will give you four windows open in R: 
a *script* to help you keep track of the commands you are entering, 
a *console* where those commands are run, 
an *environment* that show what data you have, and 
a *file* window.


## 2. How to get your data into R

Last week you calculated the diversity index for each plot within each of four site types. A diversity index allows you to understand the variation in diversity among site types. The following lines of code will allow you to get your data (the class data about the diversity of each plot) into R directly from Google Sheets.

### 2a. Make the tools you need available in R.

The tools you need are found in "packages". Packages are like books from the library: packages are pre-written bundles of code that can perform the tasks we want. They contain functions and commands to perform analyses.

```{r }
library(gsheet)
```

**Type the code (from the grey boxes) into the SCRIPT window of RStudio. Run each line using the Run button (top right of the SCRIPT window in RStudio)** 

![](RStudioRun.png)

### 2b. Tell R where to get your data.

Assign the web address of the data (the "https" address) to a variable `url`. You assign a number or word or data to a variable using `<-` (which makes something that looks like an arrow). The variable name goes on the left of the arrow and the information goes on the right. Use the link for your section.

Section 1: https://docs.google.com/spreadsheets/d/1Y_mQd_2oqeh-c8tIrQQRM86jqh7GXOTcjB6RdyfUukg/edit
Section 2: https://docs.google.com/spreadsheets/d/1ZQ4deueQIPo3suyaQIiL8ocKMvmkQHPbo7dTm1DB1HE/edit#gid=0
Section 3: https://docs.google.com/spreadsheets/d/1BgfwFZwPElpkLpaGtJjUjwMJ7PBlX7LIQa6TqEuBSyg/edit#gid=712544975
Section 4: https://docs.google.com/spreadsheets/d/15NNkz5qpgL606SjsUY0eLqh8XELc2O22-TjVYbZ5cNk/edit#gid=3539127
Section 5: https://docs.google.com/spreadsheets/d/1OP_efBrd4wDyurSWPX_PYRiH6I5tRbiVFn3xlUa6b6g/edit#gid=375935988
Section 6: https://docs.google.com/spreadsheets/d/1IuZkWdoF30zrZvjNTinvM_NguzT8EcE1b8PK0iTXaBg/edit#gid=0

```{r echo=FALSE}
url <- 'https://docs.google.com/spreadsheets/d/14tqUEo3eupHv6LFBA4zyzY97HCwxwGWJyBecL0oVkiY/edit#gid=0'
```

### 2c. Assign the data to a variable

In this case the data is contained in the variable `diversitydata`. The function `gsheet2tbl` gets the data from the website so that you can access it in R.

```{r gsheet}
diversitydata <- gsheet2tbl(url)
```

* you will need to run each line separately (put the cursor on each line and click run)
* the line was run correctly if you get the prompt (`>`) in the R console at the bottom right of RStudio
* view your data by clicking on the item in the Data window on the right side. This will open a new tab above so you can look at the data

## 3. Keep track of what your commands do

As you work you are typing commands that you probably won't remember next week. 
**Use the `#` symbol to explain your lines of code.** For example, rather than the plain code above your script might look like the following:

```{r gsheet2, eval=FALSE}
#load the package that allows use to access google sheets 
library(gsheet)

#assign the website address for the data to a variable using an arrow <-
# "variable" <- "website address for data"
url<-'https://docs.google.com/spreadsheets/d/14tqUEo3eupHv6LFBA4zyzY97HCwxwGWJyBecL0oVkiY/edit#gid=0'

#load the data from google sheets
# "variable" <- "command to work on" (data from last line)
diversitydata <- gsheet2tbl(url)
```

**SAVE your work**. Save your code by clicking `File > Save`. **Name your file Lab1_YourName.R.** Your work will save to the server that we are using for this lab.  You will be able to access your work on this server from other computers, as long as you know the web address and your username and password.


**Use the # symbol to add comments to your script as you enter the commands below**

## 4. Plot your data

To compare the diversity values among site types we need to plot the values for each site type.

### 4a. Load the library that allows us to create plots

```{r loadlibrary}
library(ggplot2)
```

### 4b. Create the base layer of your plot 

* use the command `ggplot`
    + enter the name of the variable containing your data
    + `aes` specifies the what the plot will look like ("aesthetics"), including the x and y variables
    + specify the variable names based on viewing the data
* run this plot command

```{r }
ggplot(diversitydata, aes(x=SiteType,y=Diversity))
```

### 4c. Add data points to your plot

* now that you have set up your plot add your points using `geom_point()`
* put a `+` between the `ggplot` command and `geom_point()`

```{r }
#insert comment here
ggplot(diversitydata, aes(x=SiteType,y=Diversity)) + geom_point()
```

**Remember to add real comments to your script**

### 4d. Add a boxplot on top of your plot

* a boxplot summarizes your data by plotting 
    + the median (middle) value as a horizontal line
    + the middle half of the data as a box
    + the remaining top and bottom quarters of the data as lines above and below the box
  
* add a boxplot using `geom_boxplot()`
* put a `+` between the `geom_point()` command and `geom_boxplot()`
* the `+` must come at the end of a line or the command will terminate and not plot another layer

```{r }
#insert comment here
ggplot(diversitydata, aes(x=SiteType,y=Diversity))+
  geom_point()+
  geom_boxplot()
```

**Adjust comments as needed**

* in order to see both the box and the points plot the box first then the point layer on top
  + note: the order of the plotting instructions specifies how the plot is made - i.e. first the base, then the points, then the box covering the points


## 5. Edit your boxplots

### 5a. Reorder data on the X-axis

If you want to make particular comparisons (like Sunny Mowed vs. Shady Mowed) you need to reorder your data.

* Plot the two mowed sites on the left and the two wild sides on the right side of the plot
* Use the `scale_x_discrete` command to change all the information on the x axis
* `limits` tells R what data you want to put on the x-axis
* `c()` puts this data into a list.

```{r }
#insert comment here
ggplot(diversitydata, aes(x=SiteType,y=Diversity))+
  geom_boxplot()+
  scale_x_discrete(limits=c("SuM", "ShM", "SuW", "ShW"))
```


### 5b. Add labels to your plot

Use `scale_x_discrete` to label your axes correctly.

```{r }
ggplot(diversitydata, aes(x=SiteType,y=Diversity))+
  geom_boxplot()+
  scale_x_discrete(limits=c("SuM", "ShM", "SuW", "ShW"), 
                   labels=c("SuM" = "Sunny Mowed", "ShM" = "Shade Mowed",
                            "SuW" = "Sunny Wild", 
                            "ShW" = "Shady Wild"), 
                   name ="Conditions at site")
```

### 5c. Save your boxplot as an image

* Click on Plots > Save as Image...
* Name your file and click Save.


### 5d. Look at a subset of data

If you want to only show data from the two sunny sites, then make a new variable containing these data

* First load the `dplyr` library, which contains a filtering function.

```{r, warning=FALSE,message=FALSE }
library(dplyr)
```

* Then `filter` the data to include SiteTypes SuW or SuM (the vertical bar means "and")

```{r }
SunnyOnly <- filter(diversitydata,SiteType=="SuW" | SiteType=="SuM")
```

* Now plot this new dataset using boxplots.

```{r }
ggplot(SunnyOnly, aes(x=SiteType, y=Diversity)) +
  geom_boxplot()+
  scale_x_discrete(limits=c("SuM", "SuW"),
                   labels=c("SuM" = "Sunny Mowed", "SuW" = "Sunny Wild"), 
                   name ="Conditions at site")
```
**Turn in this final boxplot of the data.**

## 6. Homework Assignment

### Part 1.
* Subset your diversity data for just the shady sites. Make a boxplot like you did in Step 5d.
* Turn in your boxplots from both sites.
* Write a summary to compare the sunny and shady sites. Which has a higher diversity? Why? (2-3 sentences)
* Make sure you include your summary tables.

### Part 2.
* Make a boxplot comparing diversity among terrestrial biomes of the United States.
* Data are available at https://docs.google.com/spreadsheets/d/1KAur7rjQtw3zN1bEQR_xXr0JRS3yn1nnvdrzQu6gWaw 
* Make a boxplot like you did in Step 4.
* Select three states and make a Diversity index boxplot for just those states like you did in Step 5d and Part 1.
* Write a summary describing differences in diversity among the states you selected (2-3 sentences).
* Make sure you include your summary tables.
